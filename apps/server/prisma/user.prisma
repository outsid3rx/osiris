model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  avatar    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  oauthAccount OAuthAccount?
  workflows    Workflow[]
  teams        TeamMember[]
  joinRequests JoinRequest[]
  createdTeams Team[]
}

model Team {
  id           String        @id @default(cuid())
  name         String
  description  String?
  type         TeamType
  creatorId    String
  creator      User          @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  teamMembers  TeamMember[]
  workflows    Workflow[]
  joinRequests JoinRequest[]
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
}

model TeamMember {
  id     String         @id @default(cuid())
  userId String
  teamId String
  role   MembershipRole
  user   User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  team   Team           @relation(fields: [teamId], references: [id], onDelete: Cascade)
}

model JoinRequest {
  id     String @id @default(cuid())
  userId String
  teamId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  team   Team   @relation(fields: [teamId], references: [id], onDelete: Cascade)
}

model OAuthAccount {
  id         String  @id @default(cuid())
  provider   String
  providerId String
  email      String
  name       String?
  avatar     String?
  userId     String  @unique
  user       User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([provider, providerId])
}

enum TeamType {
  Personal
  Shared
}

enum MembershipRole {
  Admin
  Member
}
